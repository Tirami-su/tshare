<?php
include_once("../entity/user.php");
session_start();

$user = $_SESSION['user'];
?>
<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src='https://cdn.bootcss.com/socket.io/2.0.3/socket.io.js'></script>
	<script type="text/javascript">
		// 如果服务端不在本机，请把127.0.0.1改成服务端ip
		var socket = io('http://www.haoye.com:3120');
		// 当连接服务端成功时触发connect默认事件
		socket.on('connect', function() {
		    socket.emit('login', '<?php echo $user->getEmail();?>');
		});

		socket.on('new_msg', function(msg) {
			var msg = JSON.parse(msg);
			var from = document.getElementById('from');
			var to = document.getElementById('to');
			var content = document.getElementById('content');
			var time = document.getElementById('time');

			if(msg.sender == null || msg.sender == "") {
				from.innerHTML = 'system';
			} else {
				from.innerHTML = msg.sender;
			}

			if(msg.address == null || msg.address == "") {
				to.innerHTML = 'all';
			} else {
				to.innerHTML = msg.address;
			}
			
			content.innerHTML = msg.content;
			time.innerHTML = msg.time;
		});
	</script>
</head>
<body>
	<li id='from'></li>
	<li id='to'></li>
	<li id='content'></li>
	<li id='time'></li>	
</body>
</html>